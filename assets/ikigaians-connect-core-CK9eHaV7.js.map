{"version":3,"file":"ikigaians-connect-core-CK9eHaV7.js","sources":["../../node_modules/.pnpm/isomorphic-ws@5.0.0_ws@8.18.3/node_modules/isomorphic-ws/browser.js","../../node_modules/.pnpm/@ikigaians+connect@2.9.0_ws@8.18.3/node_modules/@ikigaians/connect/dist/esm/enums/game.enum.js","../../node_modules/.pnpm/@ikigaians+connect@2.9.0_ws@8.18.3/node_modules/@ikigaians/connect/dist/esm/event/event.js","../../node_modules/.pnpm/@ikigaians+connect@2.9.0_ws@8.18.3/node_modules/@ikigaians/connect/dist/esm/connect/handlers/kicked.handler.js","../../node_modules/.pnpm/@ikigaians+connect@2.9.0_ws@8.18.3/node_modules/@ikigaians/connect/dist/esm/connect/handlers/index.js","../../node_modules/.pnpm/@ikigaians+connect@2.9.0_ws@8.18.3/node_modules/@ikigaians/connect/dist/esm/connect/connect.js","../../node_modules/.pnpm/@ikigaians+connect@2.9.0_ws@8.18.3/node_modules/@ikigaians/connect/dist/esm/lru/lru-cache.js"],"sourcesContent":["// https://github.com/maxogden/websocket-stream/blob/48dc3ddf943e5ada668c31ccd94e9186f02fafbd/ws-fallback.js\n\nvar ws = null\n\nif (typeof WebSocket !== 'undefined') {\n  ws = WebSocket\n} else if (typeof MozWebSocket !== 'undefined') {\n  ws = MozWebSocket\n} else if (typeof global !== 'undefined') {\n  ws = global.WebSocket || global.MozWebSocket\n} else if (typeof window !== 'undefined') {\n  ws = window.WebSocket || window.MozWebSocket\n} else if (typeof self !== 'undefined') {\n  ws = self.WebSocket || self.MozWebSocket\n}\n\nexport default ws\n","export var WsEvent;\n(function (WsEvent) {\n    WsEvent[\"WS_OPENED\"] = \"ws.opened\";\n    WsEvent[\"WS_CLOSED\"] = \"ws.closed\";\n    WsEvent[\"WS_RECONNECTING\"] = \"ws.reconnecting\";\n    WsEvent[\"WS_RECONNECTED\"] = \"ws.reconnected\";\n    WsEvent[\"WS_ERROR\"] = \"ws.error\";\n})(WsEvent || (WsEvent = {}));\nexport var WsAction;\n(function (WsAction) {\n    WsAction[\"ACK\"] = \"ack\";\n    WsAction[\"PING\"] = \"ping\";\n    WsAction[\"KICK\"] = \"kick\";\n})(WsAction || (WsAction = {}));\nexport var GameAction;\n(function (GameAction) {\n    GameAction[\"SUBSCRIBE_TABLE\"] = \"sub.table\";\n    GameAction[\"UNSUBSCRIBE_TABLE\"] = \"unsub.table\";\n    GameAction[\"SUBSCRIBE_LOBBY\"] = \"sub.lobby\";\n    GameAction[\"UNSUBSCRIBE_LOBBY\"] = \"unsub.lobby\";\n    /** Stop listening support chat */\n    GameAction[\"UNSUBSCRIBE_SUPPORT\"] = \"unsub.support\";\n    GameAction[\"SYNC_WALLET\"] = \"sync.wallet\";\n    /** Sends a preliminary glance of the bet for bet statistic and winner list */\n    GameAction[\"BET_PEEK\"] = \"bet.peek\";\n    GameAction[\"LIST_BET_HISTORY\"] = \"list.betHistory\";\n    GameAction[\"SUBTOTAL_BET_HISTORY\"] = \"subtotal.betHistory\";\n    /** Send a message to the chatroom in the game */\n    GameAction[\"CHAT_GAME\"] = \"chat.table\";\n    /** Send a message to support */\n    GameAction[\"CHAT_SUPPORT\"] = \"chat.support\";\n    /** Request for history of message in game */\n    GameAction[\"LIST_MESSAGE\"] = \"list.msg\";\n    /** Request for history of message in support */\n    GameAction[\"LIST_SUPPORT_MESSAGE\"] = \"list.supportMsg\";\n    /** Request to save player preference */\n    GameAction[\"SET_PREFERENCE\"] = \"set.pref\";\n})(GameAction || (GameAction = {}));\nexport var GameEvent;\n(function (GameEvent) {\n    GameEvent[\"UNKNOWN\"] = \"unknown\";\n    GameEvent[\"SESSION_KICKED\"] = \"session.kicked\";\n    GameEvent[\"TABLE_KICKED\"] = \"table.kicked\";\n    GameEvent[\"TABLE_STATE\"] = \"table.state\";\n    GameEvent[\"TABLE_START\"] = \"table.start\";\n    GameEvent[\"TABLE_BET_STOP\"] = \"table.betStop\";\n    GameEvent[\"TABLE_DEAL\"] = \"table.deal\";\n    GameEvent[\"TABLE_FINISH\"] = \"table.finish\";\n    GameEvent[\"TABLE_WINNERS\"] = \"table.winners\";\n    GameEvent[\"STREAM_ROTATE\"] = \"stream.rotate\";\n    GameEvent[\"LOBBY_STATE\"] = \"lobby.state\";\n    GameEvent[\"PLAYER_STATE\"] = \"player.state\";\n    GameEvent[\"WALLET_STATE\"] = \"wallet.state\";\n    GameEvent[\"BET_PEEK_ACK\"] = \"bet.ack\";\n    GameEvent[\"BET_RESULT\"] = \"bet.result\";\n    GameEvent[\"BET_STATS\"] = \"bet.stats\";\n    GameEvent[\"BET_HISTORY_LIST\"] = \"betHistory.list\";\n    GameEvent[\"BET_HISTORY_SUBTOTAL\"] = \"betHistory.subtotal\";\n    /** Message from the game chat */\n    GameEvent[\"GAME_MESSAGE\"] = \"table.msg\";\n    /** Message from the support dialog */\n    GameEvent[\"SUPPORT_MESSAGE\"] = \"support.msg\";\n    /** system message */\n    GameEvent[\"SYSTEM_MESSAGE\"] = \"system.msg\";\n    GameEvent[\"TABLE_PAUSE\"] = \"table.pause\";\n    GameEvent[\"TABLE_RESUME\"] = \"table.resume\";\n    GameEvent[\"TABLE_MAINTENANCE\"] = \"table.maintenance\";\n})(GameEvent || (GameEvent = {}));\n//# sourceMappingURL=game.enum.js.map","import { GameAction, GameEvent, WsAction, WsEvent, } from '../enums';\nexport class Event {\n    origin;\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    json;\n    constructor(origin) {\n        this.origin = origin;\n        this.parse();\n    }\n    get type() {\n        const value = this.json?.type;\n        if (typeof value === 'string') {\n            if (Object.values(GameAction).includes(value)) {\n                return value;\n            }\n            if (Object.values(GameEvent).includes(value)) {\n                return value;\n            }\n            if (Object.values(WsAction).includes(value)) {\n                return value;\n            }\n            if (Object.values(WsEvent).includes(value)) {\n                return value;\n            }\n        }\n        return GameEvent.UNKNOWN;\n    }\n    get syn() {\n        return this.json?.syn;\n    }\n    get timecode() {\n        return this.json?.timecode;\n    }\n    get isValid() {\n        return this.type != GameEvent.UNKNOWN;\n    }\n    get data() {\n        return this.isValid ? this.json?.data : undefined;\n    }\n    get error() {\n        return this.isValid ? this.json?.error : undefined;\n    }\n    parse() {\n        if (!this.origin) {\n            return;\n        }\n        let bufStr;\n        if (typeof this.origin === 'string') {\n            bufStr = this.origin;\n        }\n        else if (this.origin instanceof ArrayBuffer) {\n            bufStr = new TextDecoder().decode(this.origin);\n        }\n        else if (Array.isArray(this.origin) &&\n            this.origin.every((item) => item instanceof ArrayBuffer)) {\n            bufStr = this.origin.reduce((acc, buf) => acc + new TextDecoder().decode(buf), '');\n        }\n        else if (globalThis.window === undefined &&\n            Buffer.isBuffer(this.origin)) {\n            bufStr = this.origin.toString();\n        }\n        else {\n            this.json = this.origin;\n            return;\n        }\n        try {\n            this.json = JSON.parse(bufStr);\n        }\n        catch {\n            return;\n        }\n    }\n}\n//# sourceMappingURL=event.js.map","import { AfterKicked } from '@ikigaians/house';\nexport const KickedHandler = (evt, conn) => {\n    if (AfterKicked.DISCONNECT == evt.data.kicked.after) {\n        conn.close();\n    }\n};\n//# sourceMappingURL=kicked.handler.js.map","import { GameEvent } from '../../enums';\nimport { KickedHandler } from './kicked.handler';\nconst EventHandler = {\n    [GameEvent.SESSION_KICKED]: KickedHandler,\n};\nexport function execEventHandler(evt, conn) {\n    const handler = EventHandler[evt.type];\n    if (typeof handler === 'function') {\n        handler(evt, conn);\n    }\n}\n//# sourceMappingURL=index.js.map","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { MessageContentType, } from '@ikigaians/house';\nimport WebSocket from 'isomorphic-ws';\nimport { GameAction, GameEvent, WsAction, WsEvent, } from '../enums';\nimport { Event } from '../event';\nimport { execEventHandler } from './handlers';\nconst SERVER_ACTIVATE_SESSION_PATH = '/v1/exp/session/activate';\n/**\n * Live RGS websocket client.\n *\n * The heartbeat and reconnection mechanism:\n * 1. The client will send PING message to server if the last incoming message is later than `heartbeatIntervalMs`.\n * 2. The server must respond some message after receiving any message.\n * 3. The client will reconnect if the last incoming message is later than `heartbeatTimeoutMs`.\n */\nexport class Connect {\n    rgsUrl;\n    launchUrl;\n    handlerMap;\n    ws;\n    logger;\n    synNo = 0;\n    heartbeatTimer;\n    /** The last time we see a server message. */\n    lastMessageTime = 0;\n    lastHeartbeatTime = 0;\n    /** Send a heartbeat if we see no incoming message after this duration.  */\n    heartbeatIntervalMs = 1000;\n    /** If server has no response for this duration, a reconnect will be triggered. */\n    heartbeatTimeoutMs = 5000;\n    reconnectDelayMs = 1000;\n    reconnectCount = 0;\n    get sid() {\n        try {\n            return new URL(this.launchUrl ?? '').searchParams.get('sid') || '';\n        }\n        catch {\n            return '';\n        }\n    }\n    get url() {\n        const url = new URL(this.rgsUrl);\n        url.pathname = SERVER_ACTIVATE_SESSION_PATH;\n        url.searchParams.set('sid', this.sid);\n        return url.toString();\n    }\n    /**\n     * @param rgsUrl Url to game server\n     * @param launchUrl Url of current session url. If omitted, use `windows.location`\n     */\n    constructor(rgsUrl, launchUrl) {\n        this.rgsUrl = rgsUrl;\n        this.launchUrl = launchUrl;\n        this.handlerMap = new Map();\n        this.ws = undefined;\n    }\n    connect() {\n        if (!this.rgsUrl) {\n            this.logger?.error?.('Missing server URL to connect');\n            return;\n        }\n        if (!this.sid) {\n            this.logger?.error?.('Missing sid to connect');\n            return;\n        }\n        this.doConnect();\n        this.lastMessageTime = Date.now();\n        this.startHeartbeat();\n    }\n    close() {\n        if (this.heartbeatTimer) {\n            clearInterval(this.heartbeatTimer);\n            this.heartbeatTimer = undefined;\n        }\n        this.doClose();\n        this.emitEvent(WsEvent.WS_CLOSED);\n    }\n    doConnect() {\n        if (this.isConnected) {\n            return;\n        }\n        this.doClose();\n        try {\n            this.ws = new WebSocket(this.url);\n            this.ws.onmessage = this.handleMessage.bind(this);\n            this.ws.onopen = this.handleOpened.bind(this);\n            this.ws.onclose = this.handleClosed.bind(this);\n            this.ws.onerror = this.handleError.bind(this);\n        }\n        catch (error) {\n            this.logger?.error?.('Failed to create WebSocket connection', error);\n            const errorEvent = new Event({\n                type: WsEvent.WS_ERROR,\n                data: {\n                    error: error instanceof Error ? error.message : String(error),\n                },\n            });\n            this.emitEvent(WsEvent.WS_ERROR, errorEvent);\n            // Schedule retry if WebSocket construction fails\n            if (this.heartbeatTimer) {\n                setTimeout(() => {\n                    this.reconnect();\n                }, this.reconnectDelayMs);\n            }\n        }\n    }\n    doClose() {\n        if (this.ws) {\n            this.ws.onmessage = null;\n            this.ws.onopen = null;\n            this.ws.onclose = null;\n            this.ws.onerror = null;\n            try {\n                this.ws.close();\n            }\n            catch {\n                //\n            }\n            this.ws = undefined;\n        }\n    }\n    /**\n     * Registers a handler for a specific event type.\n     *\n     * This method allows you to associate a handler function with a specified event type.\n     * When an event of the specified type occurs, the registered handler will be invoked.\n     * This is useful for handling different types of events with specific logic.\n     *\n     * @param {GameEvent | string} type - The identifier of the event type to listen for. It should be one of the predefined values in the `GameEvent` enumeration.\n     * @param {WsHandler | WsHandlerAsync} handler - The event handler to be executed when the specified event type is triggered.\n     *                                               It can be either a synchronous (`WsHandler`) or asynchronous (`WsHandlerAsync`) function.\n     * @returns {this} - Returns the current instance to allow method chaining.\n     */\n    on(type, handler) {\n        this.handlerMap.set(type, handler);\n        return this;\n    }\n    /**\n     * Registers a handler for unknown event types.\n     *\n     * This method allows you to set a handler that will be invoked when an event of type `GameEvent.UNKNOWN`\n     * is received. It can be useful for handling unexpected or miscellaneous events that do not match any\n     * other predefined event types.\n     *\n     * @param {WsHandler | WsHandlerAsync} handler - The event handler to be executed for unknown events.\n     *                                               This can either be a synchronous (`WsHandler`) or\n     *                                               asynchronous (`WsHandlerAsync`) function.\n     * @returns {this} - Returns the current instance for method chaining.\n     */\n    onElse(handler) {\n        this.handlerMap.set(GameEvent.UNKNOWN, handler);\n        return this;\n    }\n    /**\n     * Sends an action with an optional payload to the WebSocket server.\n     *\n     * This method constructs a message containing a specified action and an optional payload,\n     * then sends it to the WebSocket server. If the WebSocket connection is not established,\n     * the method will return immediately without sending any data.\n     *\n     * @param {GameAction} act - The action to be sent. This should be one of the predefined actions in the `GameAction` enumeration.\n     * @param {PayloadMap[E]?} [payload] - An optional payload to include with the action. This can be any data type that is serializable to JSON.\n     *                          If no payload is provided, the action will be sent with a `data` field set to `undefined`.\n     */\n    send(act, payload) {\n        if (!this.isConnected || !this.ws) {\n            this.logger?.info?.(`Message not sent (not connected): ${act}`);\n            return;\n        }\n        const data = {\n            type: act,\n            data: undefined,\n            syn: `#${(this.synNo += 2)}`,\n        };\n        if (payload) {\n            data.data = payload;\n        }\n        const dataStr = JSON.stringify(data);\n        this.ws.send(dataStr);\n    }\n    handleMessage(msg) {\n        this.lastMessageTime = Date.now();\n        const evt = new Event(msg.data);\n        this.emitEvent(evt.type, evt);\n        this.ack(evt);\n        execEventHandler(evt, this);\n    }\n    emitEvent(type, data) {\n        let handler;\n        if (this.handlerMap.has(type)) {\n            handler = this.handlerMap.get(type);\n        }\n        if (!data) {\n            data = new Event({ data: { type } });\n        }\n        if (handler) {\n            setTimeout(() => {\n                try {\n                    handler(data, this);\n                }\n                catch (error) {\n                    this.logger?.error?.('Error in event handler', { type, error });\n                }\n            }, 0);\n        }\n        else {\n            if (type === WsAction.ACK || type === WsAction.PING) {\n                return;\n            }\n            this.logger?.info?.('unhandled message', data);\n        }\n    }\n    ack(evt) {\n        if (!evt.syn)\n            return;\n        setTimeout(() => {\n            this.send(WsAction.ACK, { syn: evt.syn });\n        }, 0);\n    }\n    handleOpened() {\n        this.lastMessageTime = Date.now();\n        if (this.reconnectCount > 0) {\n            this.emitEvent(WsEvent.WS_RECONNECTED);\n        }\n        else {\n            this.emitEvent(WsEvent.WS_OPENED);\n        }\n        this.reconnectCount = 0;\n    }\n    handleClosed() {\n        this.doClose();\n        this.emitEvent(WsEvent.WS_CLOSED);\n    }\n    handleError(event) {\n        const errorEvent = new Event({\n            type: WsEvent.WS_ERROR,\n            data: {\n                error: event.message || event.error,\n            },\n        });\n        this.emitEvent(WsEvent.WS_ERROR, errorEvent);\n    }\n    get isConnected() {\n        return this.ws && this.ws.readyState === WebSocket.OPEN;\n    }\n    startHeartbeat() {\n        this.heartbeatTimer = setInterval(() => {\n            // Skip heartbeat checks during reconnection\n            if (this.inflightReconnect) {\n                return;\n            }\n            // send ping when server has no recent activity\n            if (Date.now() - this.lastMessageTime >= this.heartbeatIntervalMs &&\n                Date.now() - this.lastHeartbeatTime >= this.heartbeatIntervalMs) {\n                this.lastHeartbeatTime = Date.now();\n                this.send(WsAction.PING);\n            }\n            // reconnect when last incoming message is too long ago\n            if (Date.now() - this.lastMessageTime > this.heartbeatTimeoutMs) {\n                this.reconnect();\n            }\n        }, 200);\n    }\n    inflightReconnect;\n    reconnect() {\n        if (this.inflightReconnect) {\n            return;\n        }\n        const promise = (async () => {\n            try {\n                this.reconnectCount++;\n                const delay = this.reconnectDelayMs * 2 ** Math.min(this.reconnectCount - 1, 2);\n                this.emitEvent(WsEvent.WS_RECONNECTING);\n                await new Promise((r) => setTimeout(r, delay));\n                this.doClose();\n                this.doConnect();\n            }\n            finally {\n                this.inflightReconnect = undefined;\n            }\n        })();\n        this.inflightReconnect = promise;\n    }\n    setLogger(logger) {\n        this.logger = logger;\n        return this;\n    }\n    /**\n     * * Functions to send GameAction events\n     */\n    /** Save and store bet information on bet server. On bet stop, it will send all previous bets to debit transaction. */\n    betPeek(roundId, gameType, gameCode, bets, count, uuid) {\n        const payload = {\n            roundId,\n            gameType,\n            gameCode,\n            bets,\n            count,\n            uuid,\n        };\n        this.send(GameAction.BET_PEEK, payload);\n    }\n    syncWallet() {\n        this.send(GameAction.SYNC_WALLET);\n    }\n    /** Request RGS to save new nickname */\n    rename(nickname) {\n        this.send(GameAction.SET_PREFERENCE, { player: { nickname } });\n    }\n    /**\n     * Request a day list that shows player bet and win subtotal.\n     * @param {number[]} days List of request days in UTC timestamp.\n     */\n    subtotalBetHistory(days) {\n        const payload = { days };\n        this.send(GameAction.SUBTOTAL_BET_HISTORY, payload);\n    }\n    /**\n     * Request a list of player's bet history.\n     * @param {number} limit The maximum number of records to return in the result set.\n     * @param {number?} offset The timestamp to skip before starting to return results.\n     */\n    listBetHistory(limit, offset) {\n        const payload = { limit, offset };\n        this.send(GameAction.LIST_BET_HISTORY, payload);\n    }\n    /** Send text message to game chat */\n    sendGameChatText(text) {\n        this.send(GameAction.CHAT_GAME, {\n            msg: {\n                content: {\n                    text,\n                    type: MessageContentType.TEXT,\n                },\n            },\n        });\n    }\n    /** List the history of game chat */\n    listGameChatHistory(gameCode, limit) {\n        this.send(GameAction.LIST_MESSAGE, {\n            gameCode,\n            limit,\n        });\n    }\n    /** List the history of support chat */\n    listSupportChatHistory(limit) {\n        this.send(GameAction.LIST_SUPPORT_MESSAGE, {\n            limit,\n        });\n    }\n    /** Send text message to support chat */\n    sendSupportChatChatText(text) {\n        this.send(GameAction.CHAT_SUPPORT, {\n            msg: {\n                content: {\n                    text,\n                    type: MessageContentType.TEXT,\n                },\n            },\n        });\n    }\n    /** Send game history to support chat. This is a convenience for frontend to render game history in chatroom */\n    sendSupportChatGameHistory(hist) {\n        this.send(GameAction.CHAT_SUPPORT, {\n            msg: {\n                content: Object.assign({\n                    type: MessageContentType.GAME_HISTORY,\n                }, hist),\n            },\n        });\n    }\n}\n//# sourceMappingURL=connect.js.map","class Element {\n    key;\n    value;\n    accessCount;\n    prev = null;\n    next = null;\n    constructor(key, value) {\n        this.key = key;\n        this.value = value;\n        this.accessCount = 0;\n    }\n}\nexport var LruCacheOption;\n(function (LruCacheOption) {\n    /** Move element to the end when set */\n    LruCacheOption[LruCacheOption[\"MoveToEndWhenSet\"] = 0] = \"MoveToEndWhenSet\";\n    /** Move element to the end when get */\n    LruCacheOption[LruCacheOption[\"MoveToEndWhenGet\"] = 1] = \"MoveToEndWhenGet\";\n})(LruCacheOption || (LruCacheOption = {}));\n/**\n * LruCache (Least Recently Used Cache) implementation.\n *\n * Provides a fixed-size cache that removes the least recently used items\n * when the capacity is reached. It supports operations like set, get, remove, and\n * retrieval of access count for each key.\n *\n * @template K The type of the keys in the cache.\n * @template V The type of the values in the cache.\n */\nexport class LruCache {\n    capacity;\n    map;\n    head;\n    tail;\n    options = new Map();\n    /**\n     * @param capacity Max size of elements\n     * @param options Define the conditions to move element to the end.\n     */\n    constructor(capacity, ...options) {\n        this.capacity = capacity;\n        this.capacity = capacity;\n        this.map = new Map();\n        this.head = null;\n        this.tail = null;\n        for (const opt of options) {\n            this.options.set(opt, true);\n        }\n    }\n    /** Insert the element by key */\n    set(key, value) {\n        if (this.map.size === this.capacity) {\n            this.pop();\n        }\n        const elem = this.map.get(key);\n        if (elem) {\n            elem.accessCount++;\n            elem.value = value;\n            if (this.options.get(LruCacheOption.MoveToEndWhenSet)) {\n                this.touch(key);\n            }\n            return;\n        }\n        const newElem = new Element(key, value);\n        this.pushToList(newElem);\n        this.map.set(key, newElem);\n    }\n    /** Returns the element of key */\n    get(key) {\n        const elem = this.map.get(key);\n        if (elem) {\n            if (this.options.get(LruCacheOption.MoveToEndWhenGet)) {\n                this.touch(key);\n            }\n            elem.accessCount++;\n            return elem.value;\n        }\n        return undefined;\n    }\n    /** Get the counter of the key has been set */\n    getAccessCount(key) {\n        const elem = this.map.get(key);\n        return elem ? elem.accessCount : 0;\n    }\n    /** Removes the element of key */\n    remove(key) {\n        const elem = this.map.get(key);\n        if (!elem)\n            return;\n        this.removeFromList(elem);\n        this.map.delete(key);\n    }\n    clear() {\n        for (const key of this.dump()) {\n            this.remove(key);\n        }\n    }\n    /** Inserts the element at the end */\n    pushToList(elem) {\n        if (!this.tail) {\n            this.head = this.tail = elem;\n            return;\n        }\n        this.tail.next = elem;\n        elem.prev = this.tail;\n        this.tail = elem;\n    }\n    removeFromList(elem) {\n        if (elem.prev) {\n            elem.prev.next = elem.next;\n        }\n        else {\n            this.head = elem.next;\n        }\n        if (elem.next) {\n            elem.next.prev = elem.prev;\n        }\n        else {\n            this.tail = elem.prev;\n        }\n        elem.prev = elem.next = null;\n    }\n    /** Removes the oldest element */\n    pop() {\n        if (this.head) {\n            this.remove(this.head.key);\n        }\n    }\n    has(key) {\n        return this.map.has(key);\n    }\n    /**\n     * Moves the element associated with the key to the most recent position.\n     */\n    touch(key) {\n        if (!this.has(key)) {\n            return;\n        }\n        const elem = this.map.get(key);\n        this.removeFromList(elem);\n        this.pushToList(elem);\n    }\n    get size() {\n        return this.map.size;\n    }\n    /** Retrieve keys in range what would not effect the order and counter */\n    dump() {\n        const keys = [];\n        let cursor = this.tail;\n        while (cursor) {\n            keys.push(cursor.key);\n            cursor = cursor.prev;\n        }\n        return keys;\n    }\n    /**\n     * Retrieve values in the cache without affecting the order or access counters.\n     *\n     * @param option - Determines the order of the returned values. Default is 'latestFirst'.\n     * @returns An array of values in the cache.\n     */\n    values(option = 'latestFirst') {\n        const values = [];\n        let cursor = this.tail;\n        while (cursor) {\n            const value = this.map.get(cursor.key)?.value;\n            if (value) {\n                if (option === 'latestLast') {\n                    values.splice(0, 0, value);\n                }\n                else {\n                    values.push(value);\n                }\n            }\n            cursor = cursor.prev;\n        }\n        return values;\n    }\n}\n//# sourceMappingURL=lru-cache.js.map"],"names":["WsEvent","WsAction","GameAction","GameEvent","WebSocket","_b","_a","LruCacheOption"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6]}